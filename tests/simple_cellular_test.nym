// Simplified cellular automata test for NymyaLang
// simple_cellular_test.nym

import image.image_basic
import crystal

// Global variables for image dimensions
const WIDTH = 200
const HEIGHT = 200

func main() -> Void {
    crystal.manifest("ðŸ”¬ Starting Simple Cellular Automata Test")
    
    // Create a simple image for Rule 2
    var img = image.image_basic.create_image(WIDTH, HEIGHT, 1)
    
    // Initialize first row with a single active cell in the center
    img.set_pixel(WIDTH / 2, 0, 255, 255, 255)
    
    // Generate subsequent rows based on simple rule
    for y in range(1, HEIGHT) {
        for x in range(0, WIDTH) {
            // Get the three neighbors from the previous row (left, center, right)
            var left_val = if x == 0 { 0 } else { get_pixel_value(img, x - 1, y - 1) }
            var center_val = get_pixel_value(img, x, y - 1)
            var right_val = if x == WIDTH - 1 { 0 } else { get_pixel_value(img, x + 1, y - 1) }
            
            // Simple rule: if center is active, next state is opposite of left XOR right
            var next_state = if center_val > 0 { 
                if (left_val > 0) != (right_val > 0) { 255 } else { 0 } 
            } else { 
                if (left_val > 0) and (right_val > 0) { 255 } else { 0 } 
            }
            
            img.set_pixel(x, y, next_state, next_state, next_state)
        }
    }
    
    crystal.manifest("âœ… Generated simple cellular automaton")
    
    // Actually save the image (this will show if it works in the implementation)
    image.image_basic.save_image(img, "simple_ca_rule2.png")
}

// Helper to get pixel value
func get_pixel_value(img: image.Image, x: Int, y: Int) -> Int {
    var pixel = img.get_pixel(x, y)
    return pixel["r"]
}

main()