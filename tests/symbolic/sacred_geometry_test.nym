// Symbolic Subsystem Tests - Sacred Geometry
// Tests for the sacred geometry subsystem

import symbolic
import crystal

namespace test_sacred_geometry {

    func test_geometry_objects() -> Void {
        crystal.manifest("Testing sacred geometry objects...")
        
        var geometry_tests = [
            ["metatron_cube", "Metatron's Cube", [13, 78]],
            ["star_tetrahedron", "Star Tetrahedron (Merkaba)", [3, 6, 9]],
            ["flower_of_life", "Flower of Life", [19]],
            ["seed_of_life", "Seed of Life", [7]],
            ["tree_of_life", "Tree of Life", [10, 22]],
            ["sri_yantra", "Sri Yantra", [9, 43]],
            ["torus_field", "Torus Field", [8, 88, 888]],
            ["phi_spiral", "Golden Ratio / Phi Spiral", [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144]]
        ]
        
        for test in geometry_tests {
            var id = test[0]
            var expected_name = test[1]
            var expected_nums = test[2]  // This will be treated as a string; we'll handle it properly below
            
            var geometry = symbolic.get_geometry_by_id(id)
            crystal.manifest("Geometry " + id + ": " + geometry.name)
            
            if geometry.name == expected_name {
                crystal.manifest("  ✓ PASS - Name matches")
            } else {
                crystal.manifest("  ✗ FAIL - Expected: " + expected_name)
            }
        }
        
        // Test the phi spiral separately as it has many numbers
        var phi_spiral = symbolic.get_geometry_by_id("phi_spiral")
        crystal.manifest("\nPhi spiral numeric correspondences: " + phi_spiral.numeric_correspondences.join(", "))
    }

    func test_number_geometry_correspondence() -> Void {
        crystal.manifest("\nTesting number-geometry correspondences...")
        
        // Test that 13 corresponds to Metatron's Cube
        var geometries_for_13 = symbolic.find_geometries_for_number(13)
        crystal.manifest("Geometries for 13: " + geometries_for_13.length + " found")
        for geom in geometries_for_13 {
            crystal.manifest("  - " + geom.name + " (" + geom.id + ")")
        }
        
        if geometries_for_13.length > 0 and geometries_for_13[0].id == "metatron_cube" {
            crystal.manifest("  ✓ PASS - 13 connects to Metatron's Cube")
        } else {
            crystal.manifest("  ✗ FAIL - 13 should connect to Metatron's Cube")
        }
        
        // Test that 19 corresponds to Flower of Life
        var geometries_for_19 = symbolic.find_geometries_for_number(19)
        crystal.manifest("Geometries for 19: " + geometries_for_19.length + " found")
        for geom in geometries_for_19 {
            crystal.manifest("  - " + geom.name + " (" + geom.id + ")")
        }
        
        if geometries_for_19.length > 0 and geometries_for_19[0].id == "flower_of_life" {
            crystal.manifest("  ✓ PASS - 19 connects to Flower of Life")
        } else {
            crystal.manifest("  ✗ FAIL - 19 should connect to Flower of Life")
        }
        
        // Test that 9 corresponds to Star Tetrahedron (part of 3-6-9 cycle)
        var geometries_for_9 = symbolic.find_geometries_for_number(9)
        crystal.manifest("Geometries for 9: " + geometries_for_9.length + " found")
        for geom in geometries_for_9 {
            crystal.manifest("  - " + geom.name + " (" + geom.id + ")")
        }
        
        var has_star_tetrahedron = false
        for geom in geometries_for_9 {
            if geom.id == "star_tetrahedron" {
                has_star_tetrahedron = true
                break
            }
        }
        
        if has_star_tetrahedron {
            crystal.manifest("  ✓ PASS - 9 connects to Star Tetrahedron")
        } else {
            crystal.manifest("  ✗ FAIL - 9 should connect to Star Tetrahedron")
        }
    }

    func test_platonic_solids() -> Void {
        crystal.manifest("\nTesting Platonic solids...")
        
        var platonic_tests = [
            ["tetrahedron", "Tetrahedron", [4, 6, 4]],
            ["cube", "Cube", [6, 12, 8]],
            ["octahedron", "Octahedron", [8, 12, 6]],
            ["dodecahedron", "Dodecahedron", [12, 30, 20]],
            ["icosahedron", "Icosahedron", [20, 30, 12]]
        ]
        
        for test in platonic_tests {
            var id = test[0]
            var expected_name = test[1]
            var expected_nums = test[2]  // This is a list that we'll handle specially
            
            var geometry = symbolic.get_geometry_by_id(id)
            crystal.manifest("Platonic solid " + id + ": " + geometry.name)
            
            if geometry.name == expected_name {
                crystal.manifest("  ✓ PASS - Name matches")
            } else {
                crystal.manifest("  ✗ FAIL - Expected: " + expected_name)
            }
        }
    }

    func run_tests() -> Void {
        crystal.manifest("=== SACRED GEOMETRY SUBSYSTEM TESTS ===")
        test_geometry_objects()
        test_number_geometry_correspondence()
        test_platonic_solids()
        crystal.manifest("=== SACRED GEOMETRY TESTS COMPLETE ===\n")
    }
}

test_sacred_geometry.run_tests()